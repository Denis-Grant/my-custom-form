<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Form with File Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .form-success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
        }
        .form-error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Contact Us & Upload Files</h2>
        
        <form id="contactForm" class="space-y-4" enctype="multipart/form-data"> 
            <div>
                <label for="Name" class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" id="Name" name="Name" required
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <div>
                <label for="Email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="Email" name="Email" required
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <div>
                <label for="Message" class="block text-sm font-medium text-gray-700">Message</label>
                <textarea id="Message" name="Message" rows="4" required
                          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
            </div>

            <div>
                <label for="imageUpload" class="block text-sm font-medium text-gray-700">Upload Files</label>
                <input type="file" id="imageUpload" name="imageUpload[]" multiple 
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                <p class="mt-1 text-sm text-gray-500">You can upload any file type (multiple files allowed).</p>
            </div>
            
            <button type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-md">
                Submit
            </button>
            
            <div id="formStatus" class="hidden text-center"></div>
        </form>
    </div>

    <script>
        const form = document.getElementById('contactForm');
        const fileInput = document.getElementById('imageUpload'); // Get reference to the file input
        const formStatus = document.getElementById('formStatus');
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxnSE1kxgeeaPKdnfnszKe904nk1Gcm3ZSCm8RyU1uUM9vREGZ__P7XttJeEfSnzx0ZlA/exec'; 

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            formStatus.classList.add('hidden'); 
            formStatus.classList.remove('form-success', 'form-error'); 
            formStatus.textContent = '';

            const formData = new FormData(); 

            formData.append('Name', document.getElementById('Name').value);
            formData.append('Email', document.getElementById('Email').value);
            formData.append('Message', document.getElementById('Message').value);

            if (fileInput.files.length > 0) {
                console.log('Files detected in input:', fileInput.files.length);
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    console.log(`Appending file ${i}: ${file.name}, type: ${file.type}, size: ${file.size}`);
                    formData.append('imageUpload[]', file, file.name); 
                }
            } else {
                console.log('No files selected in the input.');
            }

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: formData,
                });

                formStatus.textContent = 'Form submitted successfully! Please check your Google Sheet and Google Drive.';
                formStatus.classList.remove('hidden');
                formStatus.classList.add('form-success');
                form.reset();

            } catch (error) {
                console.error('Error submitting form:', error);
                formStatus.textContent = 'There was an error submitting your form or uploading files. Please try again.';
                formStatus.classList.remove('hidden');
                formStatus.classList.add('form-error');
            }
        });
    </script>
</body>
</html>